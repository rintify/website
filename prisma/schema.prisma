datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Permission {
  PUBLIC
  PRIVATE
}

model User {
  id            String @id @default(ulid())
  name          String @unique
  nickName      String @default("")
  passwordHash  String @default("")
  comment       String @default("")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  groups        Group[]
}

model Group {
  id  String @id @default(ulid())
  name String @default("unknown")
  comment       String @default("")
  createdAt     DateTime @default(now())
  visibility Permission @default(PRIVATE)
  editability Permission @default(PRIVATE)

  ownerId String
  owner   User     @relation(fields: [ownerId], references: [id])

  persons Person[]
  timeTables Timetable[]
}

model Person {
  id            String @id @default(ulid())
  name      String @default("unknown")
  comment       String @default("")
  createdAt     DateTime @default(now())

  groupId String
  group Group @relation(fields: [groupId], references: [id], onDelete: Cascade)

  timeBands      TimeBand[]
}

model Timetable {
  id          String   @id @default(ulid())
  name        String   @default("unknown")
  comment String   @default("")
  createdAt     DateTime @default(now())

  groupId String
  group Group @relation(fields: [groupId], references: [id], onDelete: Cascade)

  timeBands      TimeBand[]
}

model TimeBand {
  id        String    @id @default(ulid())
  startTime DateTime
  endTime   DateTime
  comment String

  timeTableId   String
  timeTable     Timetable     @relation(fields: [timeTableId], references: [id], onDelete: Cascade)
  
  personId String
  person Person     @relation(fields: [personId], references: [id], onDelete: Cascade)
}

// DATABASE_URL="file:./dev.db"
//npx prisma migrate dev --name init